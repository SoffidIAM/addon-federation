package test;

import java.io.IOException;
import java.util.Base64;

import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.databind.JsonMappingException;

import es.caib.seycon.idp.ui.cred.ParseException;
import es.caib.seycon.idp.ui.cred.WebCredentialParser;
import junit.framework.TestCase;

public class UserCredentialTest extends TestCase {
	static final String ATTESTATION = "o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDE5ODMxMDM3aHJlc3BvbnNlWRTCZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHYkVSRFEwSkllV2RCZDBsQ1FXZEpVa0ZOVDNScFZEUjNMMjlJY1VOQlFVRkJRVUZtVWpOUmQwUlJXVXBMYjFwSmFIWmpUa0ZSUlV4Q1VVRjNVV3BGVEUxQmEwZEJNVlZGUW1oTlExWldUWGhJYWtGalFtZE9Wa0pCYjFSR1ZXUjJZakprYzFwVFFsVmpibFo2WkVOQ1ZGcFlTakpoVjA1c1kzcEZWRTFDUlVkQk1WVkZRWGhOUzFJeFVsUkpSVTVDU1VSR1VFMVVRV1ZHZHpCNFQxUkZlRTFVVVhkUFZGRXdUVVJrWVVaM01IbE5SRUY1VFZSSmQwOVVVVEJOUkdSaFRVZDNlRU42UVVwQ1owNVdRa0ZaVkVGc1ZsUk5VazEzUlZGWlJGWlJVVWxGZDNCRVdWZDRjRnB0T1hsaWJXeG9UVkpaZDBaQldVUldVVkZJUlhjeFRtSXpWblZrUjBad1ltbENWMkZYVmpOTlVrMTNSVkZaUkZaUlVVdEZkM0JJWWpJNWJtSkhWV2RVUlhoRVRWSnpkMGRSV1VSV1VWRkVSWGhLYUdSSVVteGpNMUYxV1ZjMWEyTnRPWEJhUXpWcVlqSXdkMmRuUldsTlFUQkhRMU54UjFOSllqTkVVVVZDUVZGVlFVRTBTVUpFZDBGM1oyZEZTMEZ2U1VKQlVVUXlLekJYZERBNFpISTRkbTlHWVhFNGRVcFdORGt2TkRWd2NGZzVaVUppV1RrNGJGcFFOVVJtU1c4NWRrUkpZekJYU3pFMFlsbHZReTh4V2t4SWMxWnZaWFoyV2tkU1JHSjBlVGhCUmtGTVN5dDNkbGd3TWt4cU1tMU9ZVWhMWkZKMVNsbDJVMHBhYld0UVRETXdiR3hrUXpRNGEzZDZZbkl5V2pFek4wWm5iMWx1UTFSeFQzRk5hMXA1SzJkV1JtTnNWRU5WYVZWb1pVUXlRbHBwYlU5cFpFVllhbVUwZFRFeGVXaExkbE5qVEc1elJuRnJVVXBqZGt4eWFUWkpPVTQwVFZWc1JEUlFibFI0YzNGUlZqRTROM2hETkhBeFZWZENWVE40TlZOMWVqVklUWGxJVmt4SFMxTmlaVFJXTTJZM1dGaDBVMGhVSzBjemMxbHlSRlpVYm5aMGVYQkVVV3B3V21NMVRVWTNSak5CZFRReWNXNHhTRVJFUzJkNWIxaEVTeTgyWWtacU5WVkhPVmxST1c5UWMyeDJSWFJvYjFndmRXZEdZMEZYVXpRM2QxWXZVbVJPZFVrdmF5OHJTWFpHWlVKbVVrRm5UVUpCUVVkcVoyZEtXazFKU1VOV1ZFRlBRbWRPVmtoUk9FSkJaamhGUWtGTlEwSmhRWGRGZDFsRVZsSXdiRUpCZDNkRFoxbEpTM2RaUWtKUlZVaEJkMFYzUkVGWlJGWlNNRlJCVVVndlFrRkpkMEZFUVdSQ1owNVdTRkUwUlVablVWVlBWblJ1ZW1Jd2JVbHlaR3NyUjNZck1tTkRhaTlQUW01dFkwbDNTSGRaUkZaU01HcENRbWQzUm05QlZXMU9TRFJpYUVSeWVqVjJjMWxLT0ZsclFuVm5Oak13U2k5VGMzZGFRVmxKUzNkWlFrSlJWVWhCVVVWRlYwUkNWMDFEWTBkRFEzTkhRVkZWUmtKNlFVSm9hSFJ2WkVoU2QwOXBPSFppTWs1NlkwTTFkMkV5YTNWYU1qbDJXbms1Ym1SSVRYaGlla1YzUzNkWlNVdDNXVUpDVVZWSVRVRkxSMGd5YURCa1NFRTJUSGs1ZDJFeWEzVmFNamwyV25rNWJtTXpTWGxNTUdSVlZYcEdVRTFUTldwamJsRjNTRkZaUkZaU01GSkNRbGwzUmtsSlUxbFlVakJhV0U0d1RHMUdkVnBJU25aaFYxRjFXVEk1ZEUxRFJVZEJNVlZrU1VGUllVMUNaM2REUVZsSFdqUkZUVUZSU1VOTlFYZEhRMmx6UjBGUlVVSXhibXREUWxGTmQweDNXVVJXVWpCbVFrTm5kMHBxUVd0dlEwdG5TVWxaWldGSVVqQmpSRzkyVERKT2VXSkROWGRoTW10MVdqSTVkbHA1T1VoV1JrMTRWSHBGZFZrelNuTk5TVWxDUWxGWlMwdDNXVUpDUVVoWFpWRkpSVUZuVTBJNVoxTkNPSGRFZUVGSVkwRnphRFJHZWtsMWFYcFpiMmRVYjJSdEsxTjFOV2xwVldkYU1uWmhLMjVFYm5OcmJGUk1aU3RNYTBZMFFVRkJSblZoV1U1b2NsRkJRVUpCVFVGVFJFSkhRV2xGUVdkS2VUUkxWVWRYZEVkV1MxaDNlWFY0V2swclRXaFVSMnd4VEVsR09GRndjbEJXUzJWWU5UWkJUVGhEU1ZGRWVVczFTRUZsZG5SbVN6bDJPRmhXWVVwVlpuSjVObEV6YWtSb2JXeHpPR3BHWkcxMlRXNTZWa0kwUVVJeVFVWTJibU12Ym1aV2MwUnVkRlJhU1daa1FrbzBSRW8yYTFwdlRXaExSVk5GYjFGWlpGcGhRbU5WVmxsQlFVRkNZbTF0UkZsa2EwRkJRVkZFUVVWamQxSlJTV2RYYTBScVNUSXdhVWQ1VG5OalMxaHZWUzlSSzFFd2NFUjBkaXQxYmxKS1dYcFNVVkJMU1RVeE4zbE5RMGxSUXpaUU5Wb3hLMGRqWkhwNWQwNUVVa2hvWkVSbldrdFBla2RUYmxkUk1GZ3ZjRVJZTWtWbGJVYzJlR3BCVGtKbmEzRm9hMmxIT1hjd1FrRlJjMFpCUVU5RFFWRkZRV2xCTWxWc1NWZE1jRzVGTlZCd1VXSktWMU5sTUVsdWEwdEtZV1psZFVKdFpVOUVVMlJWUzIxd1puZDJjVVJEVGpST1JIUlFVVXBEUmpGcFZrNVdla1JJUldKdmRscG1ka3gyT0M5T1VGcDZiR3N2WlM4M05rcHpWaTkyYzJ0WmRGZFpZbTE1ZW5aWVlYTXhPR1pJYUdsWGVtUkxSMmN3ZFVadWFXTkhPRzFzUkZGdmRIUnVWblpvWmxoV1VuRlViM3BOYWt0b1NHTTVVaTlFYXlzMFlVdzJlR3RXVGxCU1VrUk5aM0E1ZVVSWE4yZFplbmswVDBKTkwxbEZXbkkyYW1kTU9YQjVObUVyTTNNNVIwTlhjbVV6UkdOeGEwNXRaRGg0Uldob2RGbHRTM1p1SzFaVVVXMTFXa3hSWm1FNGJpdHlabTVMTUUxMWJXZFRNR2hETkRac2JpdFFlVXBWTXpBMWJEZGtiaXREU21jME0xWjFVVzVPZW1GaVZXaHNWV1p5UzBkRFdVUmpNeTl2Wmk5aVRuVk1UekZtUlVadlZrUkRjSFJJTmxNclFtSjZVRll2Y0VKS2NXd3piemxzV21aUWRYSldRVDA5SWl3aVRVbEpSVk5xUTBOQmVrdG5RWGRKUWtGblNVNUJaVTh3YlhGSFRtbHhiVUpLVjJ4UmRVUkJUa0puYTNGb2EybEhPWGN3UWtGUmMwWkJSRUpOVFZOQmQwaG5XVVJXVVZGTVJYaGtTR0pIT1dsWlYzaFVZVmRrZFVsR1NuWmlNMUZuVVRCRloweFRRbE5OYWtWVVRVSkZSMEV4VlVWRGFFMUxVako0ZGxsdFJuTlZNbXh1WW1wRlZFMUNSVWRCTVZWRlFYaE5TMUl5ZUhaWmJVWnpWVEpzYm1KcVFXVkdkekI0VG5wQk1rMVVWWGROUkVGM1RrUktZVVozTUhsTlZFVjVUVlJWZDAxRVFYZE9SRXBoVFVWSmVFTjZRVXBDWjA1V1FrRlpWRUZzVmxSTlVqUjNTRUZaUkZaUlVVdEZlRlpJWWpJNWJtSkhWV2RXU0VveFl6TlJaMVV5Vm5sa2JXeHFXbGhOZUVWNlFWSkNaMDVXUWtGTlZFTnJaRlZWZVVKRVVWTkJlRlI2UlhkblowVnBUVUV3UjBOVGNVZFRTV0l6UkZGRlFrRlJWVUZCTkVsQ1JIZEJkMmRuUlV0QmIwbENRVkZFVVVkTk9VWXhTWFpPTURWNmExRlBPU3QwVGpGd1NWSjJTbnA2ZVU5VVNGYzFSSHBGV21oRU1tVlFRMjUyVlVFd1VXc3lPRVpuU1VObVMzRkRPVVZyYzBNMFZESm1WMEpaYXk5cVEyWkRNMUl6VmxwTlpGTXZaRTQwV2t0RFJWQmFVbkpCZWtSemFVdFZSSHBTY20xQ1FrbzFkM1ZrWjNwdVpFbE5XV05NWlM5U1IwZEdiRFY1VDBSSlMyZHFSWFl2VTBwSUwxVk1LMlJGWVd4MFRqRXhRbTF6U3l0bFVXMU5SaXNyUVdONFIwNW9jalU1Y1Uwdk9XbHNOekZKTW1ST09FWkhabU5rWkhkMVlXVnFOR0pZYUhBd1RHTlJRbUpxZUUxalNUZEtVREJoVFROVU5Fa3JSSE5oZUcxTFJuTmlhbnBoVkU1RE9YVjZjRVpzWjA5Slp6ZHlVakkxZUc5NWJsVjRkamgyVG0xcmNUZDZaRkJIU0ZocmVGZFpOMjlIT1dvclNtdFNlVUpCUW1zM1dISktabTkxWTBKYVJYRkdTa3BUVUdzM1dFRXdURXRYTUZremVqVnZlakpFTUdNeGRFcExkMGhCWjAxQ1FVRkhhbWRuUlhwTlNVbENUSHBCVDBKblRsWklVVGhDUVdZNFJVSkJUVU5CV1ZsM1NGRlpSRlpTTUd4Q1FsbDNSa0ZaU1V0M1dVSkNVVlZJUVhkRlIwTkRjMGRCVVZWR1FuZE5RMDFDU1VkQk1WVmtSWGRGUWk5M1VVbE5RVmxDUVdZNFEwRlJRWGRJVVZsRVZsSXdUMEpDV1VWR1NtcFNLMGMwVVRZNEsySTNSME5tUjBwQlltOVBkRGxEWmpCeVRVSTRSMEV4VldSSmQxRlpUVUpoUVVaS2RtbENNV1J1U0VJM1FXRm5ZbVZYWWxOaFRHUXZZMGRaV1hWTlJGVkhRME56UjBGUlZVWkNkMFZDUWtOcmQwcDZRV3hDWjJkeVFtZEZSa0pSWTNkQldWbGFZVWhTTUdORWIzWk1NamxxWXpOQmRXTkhkSEJNYldSMllqSmpkbG96VG5sTmFrRjVRbWRPVmtoU09FVkxla0Z3VFVObFowcGhRV3BvYVVadlpFaFNkMDlwT0haWk0wcHpURzVDY21GVE5XNWlNamx1VERKa2VtTnFTWFphTTA1NVRXazFhbU50ZDNkUWQxbEVWbEl3WjBKRVozZE9ha0V3UW1kYWJtZFJkMEpCWjBsM1MycEJiMEpuWjNKQ1owVkdRbEZqUTBGU1dXTmhTRkl3WTBoTk5reDVPWGRoTW10MVdqSTVkbHA1T1hsYVdFSjJZekpzTUdJelNqVk1la0ZPUW1kcmNXaHJhVWM1ZHpCQ1FWRnpSa0ZCVDBOQlVVVkJSMjlCSzA1dWJqYzRlVFp3VW1wa09WaHNVVmRPWVRkSVZHZHBXaTl5TTFKT1IydHRWVzFaU0ZCUmNUWlRZM1JwT1ZCRllXcDJkMUpVTW1sWFZFaFJjakF5Wm1WemNVOXhRbGt5UlZSVmQyZGFVU3RzYkhSdlRrWjJhSE5QT1hSMlFrTlBTV0Y2Y0hOM1YwTTVZVW81ZUdwMU5IUlhSRkZJT0U1V1ZUWlpXbG92V0hSbFJGTkhWVGxaZWtweFVHcFpPSEV6VFVSNGNucHRjV1Z3UWtObU5XODRiWGN2ZDBvMFlUSkhObmg2VlhJMlJtSTJWRGhOWTBSUE1qSlFURkpNTm5VelRUUlVlbk16UVRKTk1XbzJZbmxyU2xscE9IZFhTVkprUVhaTFRGZGFkUzloZUVKV1lucFpiWEZ0ZDJ0dE5YcE1VMFJYTlc1SlFVcGlSVXhEVVVOYWQwMUlOVFowTWtSMmNXOW1lSE0yUWtKalEwWkpXbFZUY0hoMU5uZzJkR1F3VmpkVGRrcERRMjl6YVhKVGJVbGhkR292T1dSVFUxWkVVV2xpWlhRNGNTODNWVXMwZGpSYVZVNDRNR0YwYmxwNk1YbG5QVDBpWFgwLmV5SnViMjVqWlNJNklqbDROV1EzTVZCcGRuRjJUMVJJVUU1cWJEWldVbkU1T0VSV2N5dHdVbkUyVVdRNFVsWTJPR2RPWXpROUlpd2lkR2x0WlhOMFlXMXdUWE1pT2pFMU56ZzNOVFF3TXpnNU1qQXNJbUZ3YTFCaFkydGhaMlZPWVcxbElqb2lZMjl0TG1kdmIyZHNaUzVoYm1SeWIybGtMbWR0Y3lJc0ltRndhMFJwWjJWemRGTm9ZVEkxTmlJNkltaEhTVmhSVTI1WVJXZHJVMk5VUzNGRFJsbExWM1JzYTNSRE5FVktTWEI0TlhSb2FUbG9ZbGhITm1zOUlpd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcDBjblZsTENKaGNHdERaWEowYVdacFkyRjBaVVJwWjJWemRGTm9ZVEkxTmlJNld5STRVREZ6VnpCRlVFcGpjMngzTjFWNlVuTnBXRXcyTkhjclR6VXdSV1FyVWtKSlEzUmhlVEZuTWpSTlBTSmRMQ0ppWVhOcFkwbHVkR1ZuY21sMGVTSTZkSEoxWlgwLlpZNndvQkxGdHg2ZlZFV2hHTXozRFp1UmhxaTVRenUyZEJBR1BJb3VOanJNMV93VXRYZVlGY09sN3VaMjdLRFAtdmlIV3RNcXZ5X2xNaklneVRwTTF1eVZHeW9fdWZabmZQRjBWZzhCajNPUjVuM2YwWmdRVEZSelhocmk2NFlObHliUlBUR3RGbHh6cTlyTHJxZkNXOXRtVGJPQldaTlgwOGNJNVdVTWNZVkdRZ2d0QS1KZ1g3dHd2RmZIcEFmS283LXlhdEpYRGViRmEya2tTY3d3MDBmVUt6MUFNcl9IaXZrcGVZcGJ3c2l2eWU3dWEwUFB6NXNyZDIzYy1YUUlySDhoOFZJVE5lRG8zVVZLQzdRX3NCa245RHVXNjNtaVBYczJxUTR6UkZsZFRtdW1lQ2dpTm41Tk9jWlNaeWEtcTRpY1p3QzBVenVycThyNlJnOFowUWhhdXRoRGF0YVjFvqZtVY+/EA0G6X3WaCozZVWoirJ5AnmPvlTTl372mlZFAAAAALk/2WHy5kYvsSKCACJH3ngAQQEjXgzUT2DybKp/kAYv5dQ/2eo9qDrcRQA7M26x799JoZ8AxvvIB15lHVYLIfjWcOlCSAZv3sbenTGBr8lvvNpBpQECAyYgASFYIMq6f6r9Ezc+t+TtqrOzYPbpPXkD2oms88YuyUpG3LzaIlggMoFdhaUhaMUoM4xhWNbn2oGVjQ/kWJGUyTnDfuzyySs="; 
	static final String CLIENT_JSON = "eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoiZUFVV3FQQ1QxRGNKZjhsQ1dVa2FkTk1LWWNQYjZsX1ZNLTJOQkM5R3QxOXZYZGdHUlRrQnJlanNNdGd2LUgtUWs0alU5aGhHN2dOOElERmRRempBN2ciLCJvcmlnaW4iOiJodHRwczpcL1wvc29mZmlkLmJ1YnUubGFiOjI0NDMiLCJhbmRyb2lkUGFja2FnZU5hbWUiOiJjb20uYW5kcm9pZC5jaHJvbWUifQ==";
	static final String CHALLENGE = "eAUWqPCT1DcJf8lCWUkadNMKYcPb6l_VM-2NBC9Gt19vXdgGRTkBrejsMtgv-H-Qk4jU9hhG7gN8IDFdQzjA7g";
	
	static final String CLIENT_JSON_V = "eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoiT0l0Qm5wRGh4b2xodWs0TDF3V3UzQXBTdVdFUnlvTDQzVjNyeURueTQ3T3d2VzBYLWdFM1FFOXlnb2FNNEpjdVVQWnhnY0FMYVAtOFdmQzJxeTNhQnciLCJvcmlnaW4iOiJodHRwczpcL1wvc29mZmlkLmJ1YnUubGFiOjI0NDMiLCJhbmRyb2lkUGFja2FnZU5hbWUiOiJjb20uYW5kcm9pZC5jaHJvbWUifQ==";
	static final String ATTESTATION_V = "vqZtVY+/EA0G6X3WaCozZVWoirJ5AnmPvlTTl372mlYFAAAABQ==";
	static final String SIGNATURE_V =  "MEUCIQCVACLa0S3z+2BzSVSyT4LZh1XKsZlO1Tc5GgRBOi8CtwIgUYeyghhdi9sEJYhXlj6NVTL4BZAS53+iZbhJTXDkiao=";
	static final String CHALLENGE_V = "OItBnpDhxolhuk4L1wWu3ApSuWERyoL43V3ryDny47OwvW0X-gE3QE9ygoaM4JcuUPZxgcALaP-8WfC2qy3aBw";

	public void testParse () throws Exception {
		WebCredentialParser parser = new WebCredentialParser();
		
		
		parser.parse(CLIENT_JSON, ATTESTATION, Base64.getUrlDecoder().decode( CHALLENGE) );
		String pk = parser.getPublicKey();
		
		parser = new WebCredentialParser();
		parser.setPublicKey(pk);
		parser.parseAuthentication(CLIENT_JSON_V, ATTESTATION_V, 
				Base64.getUrlDecoder().decode(CHALLENGE_V), SIGNATURE_V, true);
	}
	
}
